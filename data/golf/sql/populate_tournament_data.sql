CREATE TABLE tournaments_data AS
SELECT
    r.tour,
    r.year,
	datetime(r.date) AS converted_date, 
    r.event_id,
    e.event_name,
    r.dg_id,
    r.player_name,
    r.fin_text,
    MAX(CASE WHEN r.round_num = 1 THEN r.course_num END) AS course_num_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.course_name END) AS course_name_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.course_par END) AS course_par_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.round_score END) AS round_score_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.sg_putt END) AS sg_putt_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.sg_arg END) AS sg_arg_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.sg_app END) AS sg_app_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.sg_ott END) AS sg_ott_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.sg_t2g END) AS sg_t2g_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.sg_total END) AS sg_total_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.driving_dist END) AS driving_dist_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.driving_acc END) AS driving_acc_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.gir END) AS gir_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.scrambling END) AS scrambling_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.prox_rgh END) AS prox_rgh_1,
    MAX(CASE WHEN r.round_num = 1 THEN r.prox_fw END) AS prox_fw_1,
    MAX(CASE WHEN r.round_num = 2 THEN r.course_num END) AS course_num_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.course_name END) AS course_name_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.course_par END) AS course_par_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.round_score END) AS round_score_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.sg_putt END) AS sg_putt_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.sg_arg END) AS sg_arg_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.sg_app END) AS sg_app_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.sg_ott END) AS sg_ott_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.sg_t2g END) AS sg_t2g_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.sg_total END) AS sg_total_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.driving_dist END) AS driving_dist_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.driving_acc END) AS driving_acc_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.gir END) AS gir_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.scrambling END) AS scrambling_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.prox_rgh END) AS prox_rgh_2,
    MAX(CASE WHEN r.round_num = 2 THEN r.prox_fw END) AS prox_fw_2,
    MAX(CASE WHEN r.round_num = 3 THEN r.course_num END) AS course_num_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.course_name END) AS course_name_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.course_par END) AS course_par_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.round_score END) AS round_score_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.sg_putt END) AS sg_putt_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.sg_arg END) AS sg_arg_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.sg_app END) AS sg_app_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.sg_ott END) AS sg_ott_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.sg_t2g END) AS sg_t2g_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.sg_total END) AS sg_total_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.driving_dist END) AS driving_dist_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.driving_acc END) AS driving_acc_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.gir END) AS gir_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.scrambling END) AS scrambling_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.prox_rgh END) AS prox_rgh_3,
    MAX(CASE WHEN r.round_num = 3 THEN r.prox_fw END) AS prox_fw_3,
    MAX(CASE WHEN r.round_num = 4 THEN r.course_num END) AS course_num_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.course_name END) AS course_name_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.course_par END) AS course_par_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.round_score END) AS round_score_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.sg_putt END) AS sg_putt_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.sg_arg END) AS sg_arg_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.sg_app END) AS sg_app_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.sg_ott END) AS sg_ott_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.sg_t2g END) AS sg_t2g_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.sg_total END) AS sg_total_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.driving_dist END) AS driving_dist_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.driving_acc END) AS driving_acc_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.gir END) AS gir_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.scrambling END) AS scrambling_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.prox_rgh END) AS prox_rgh_4,
    MAX(CASE WHEN r.round_num = 4 THEN r.prox_fw END) AS prox_fw_4,
    w.minimum_temperature,
    w.maximum_temperature,
    w.temperature,
    w.precipitation_amount,
    w.wind_gust,
    w.wind_speed,
    w.updated
FROM rounds AS r
JOIN events AS e ON r.event_id = e.event_id
JOIN courses AS c ON r.course_num = c.course_num
LEFT JOIN weather AS w ON converted_date = w.date AND r.course_name = w.course_name
WHERE r.round_num <= 4
GROUP BY r.dg_id, r.event_id;
